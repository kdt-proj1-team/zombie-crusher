<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vampire Survivors Clone</title>
  <!-- Phaser 3 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
  <style>
    body {
      margin: 0;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    // 게임 설정
    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      backgroundColor: "#222",
      physics: {
        default: "arcade",
        arcade: {
          gravity: { y: 0 },
          debug: false
        }
      },
      scene: {
        preload: preload,
        create: create,
        update: update
      }
    };

    const game = new Phaser.Game(config);

    let player, cursors, enemyGroup, spawnTimer = 0, score = 0, scoreText;

    // preload: 리소스 로드
    function preload() {
      // 플레이어 이미지 (Phaser Labs 예제 이미지 사용)
      this.load.image("player", "https://labs.phaser.io/assets/sprites/phaser-dude.png");
      // 적 이미지 (예제 이미지 사용)
      this.load.image("enemy", "https://labs.phaser.io/assets/sprites/enemy.png");
    }

    // create: 게임 오브젝트 생성
    function create() {
      // 플레이어 생성 (중앙)
      player = this.physics.add.sprite(400, 300, "player");
      player.setCollideWorldBounds(true);
      // 적 그룹 생성
      enemyGroup = this.physics.add.group();

      // 키보드 입력 설정
      cursors = this.input.keyboard.createCursorKeys();

      // 플레이어와 적 간의 충돌(오버랩) 처리
      this.physics.add.overlap(player, enemyGroup, hitEnemy, null, this);

      // 점수 표시
      scoreText = this.add.text(10, 10, "Score: 0", { fontSize: "20px", fill: "#fff" });
    }

    // update: 매 프레임마다 호출
    function update(time, delta) {
      // 플레이어 이동 (속도 200)
      const speed = 200;
      player.setVelocity(0);
      if (cursors.left.isDown) {
        player.setVelocityX(-speed);
      } else if (cursors.right.isDown) {
        player.setVelocityX(speed);
      }
      if (cursors.up.isDown) {
        player.setVelocityY(-speed);
      } else if (cursors.down.isDown) {
        player.setVelocityY(speed);
      }

      // 일정 시간마다 적 스폰 (2초 간격)
      spawnTimer += delta;
      if (spawnTimer > 2000) {
        spawnEnemy(this);
        spawnTimer = 0;
      }

      // 적들이 플레이어를 향해 이동하도록 설정
      enemyGroup.getChildren().forEach(function(enemy) {
        this.physics.moveToObject(enemy, player, enemy.speed);
      }, this);
    }

    // 적 스폰 함수
    function spawnEnemy(scene) {
      // 랜덤한 가장자리에서 적을 생성
      let spawnEdge = Phaser.Math.Between(1, 4);
      let x, y;
      if (spawnEdge === 1) { // 위쪽
        x = Phaser.Math.Between(0, scene.scale.width);
        y = 0;
      } else if (spawnEdge === 2) { // 아래쪽
        x = Phaser.Math.Between(0, scene.scale.width);
        y = scene.scale.height;
      } else if (spawnEdge === 3) { // 왼쪽
        x = 0;
        y = Phaser.Math.Between(0, scene.scale.height);
      } else { // 오른쪽
        x = scene.scale.width;
        y = Phaser.Math.Between(0, scene.scale.height);
      }
      let enemy = enemyGroup.create(x, y, "enemy");
      enemy.speed = Phaser.Math.Between(50, 100);
      enemy.setCollideWorldBounds(true);
    }

    // 플레이어와 적이 충돌했을 때
    function hitEnemy(player, enemy) {
      // 적 제거, 점수 증가
      enemy.destroy();
      score += 10;
      scoreText.setText("Score: " + score);
    }
  </script>
</body>
</html>